---
apiVersion: v1
kind: Secret
metadata:
  name: minio-secret
  namespace: my-ripsaw
type: kubernetes.io/basic-auth
stringData:
  username: admin
  password: foofoofoo
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: minio-local-volume
  namespace: my-ripsaw
  labels:
    type: local
spec:
  storageClassName: minio-local
  capacity:
    storage: 1Gi
  accessModes:
    - ReadWriteOnce
  hostPath:
    path: "/tmp/minio"
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: minio-pv-claim
  namespace: my-ripsaw
spec:
  storageClassName: minio-local
  accessModes:
     - ReadWriteOnce
  resources:
    requests:
      storage: 500Mi
---
apiVersion: v1
kind: Pod
metadata:
  name: minio-s3-server
  namespace: my-ripsaw
  labels:
    app: minio
spec:
  serviceAccountName: benchmark-operator
  containers:
  - name: minio-s3-server
    image: quay.io/bengland2/minio:latest
    imagePullPolicy: Always
    ports:
    - containerPort: 8762
      name: s3-endpoint
      protocol: TCP
    env:
    - name: MINIO_PORT_NUM
      value: "8762"
    command: ["/opt/run_minio_server_in_k8s.sh"]
    # we don't need all the same volumes as the toolbox pod
    volumeMounts:
    - name: minio
      mountPath: /mnt/minio
    - name: creds
      mountPath: /mnt/creds
  volumes:
  - name: minio
    persistentVolumeClaim:
      claimName: minio-pv-claim
  - name: creds
    secret:
      secretName: minio-secret
      items:
      - key: username
        path: username
        mode: 0666
      - key: password
        path: password
        mode: 0400
